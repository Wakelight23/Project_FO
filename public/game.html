<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Soccer Simulation</title>
        <style>
            body {
                margin: 0;
                padding: 0;
                display: flex;
                justify-content: center;
                align-items: center;
                height: 100vh;
                background-color: #2c3e50;
            }
            .soccer-field {
                position: relative;
                width: 600px;
                height: 400px;
                background: green;
                border: 2px solid white;
                overflow: hidden;
            }
            .ball {
                position: absolute;
                width: 20px;
                height: 20px;
                background: white;
                border-radius: 50%;
                transition: all 1s linear;
            }
            .player {
                position: absolute;
                width: 30px;
                height: 30px;
                border-radius: 50%;
                display: flex;
                justify-content: center;
                align-items: center;
                color: white;
                font-size: 12px;
            }
            .team-a {
                background-color: blue;
            }
            .team-b {
                background-color: red;
            }
            .scoreboard {
                position: absolute;
                top: 10px;
                left: 10px;
                background: white;
                padding: 5px 10px;
                border-radius: 5px;
                font-family: Arial, sans-serif;
            }
            .events-log {
                position: absolute;
                bottom: 10px;
                left: 10px;
                background: white;
                padding: 10px;
                max-height: 100px;
                overflow-y: auto;
                font-family: Arial, sans-serif;
                font-size: 12px;
                border-radius: 5px;
            }
        </style>
    </head>
    <body>
        <div class="soccer-field">
            <div class="scoreboard">Team A: 0 - 0 Team B</div>
            <div class="events-log"></div>
            <div class="ball" style="top: 190px; left: 290px"></div>
            <div class="player team-a" style="top: 50px; left: 100px">1</div>
            <div class="player team-a" style="top: 150px; left: 100px">2</div>
            <div class="player team-a" style="top: 250px; left: 100px">3</div>
            <div class="player team-b" style="top: 50px; left: 400px">1</div>
            <div class="player team-b" style="top: 150px; left: 400px">2</div>
            <div class="player team-b" style="top: 250px; left: 400px">3</div>
        </div>
        <script>
            // 경기 결과 설정
            const matchEvents = [
                { time: 5, team: 'A', scorer: 1 },
                { time: 10, team: 'B', scorer: 2 },
                { time: 15, team: 'A', scorer: 3 },
            ];

            // 초기 점수
            let scoreA = 0;
            let scoreB = 0;

            // 요소 가져오기
            const ball = document.querySelector('.ball');
            const playersA = document.querySelectorAll('.player.team-a');
            const playersB = document.querySelectorAll('.player.team-b');
            const scoreboard = document.querySelector('.scoreboard');

            // 경기장 중앙 좌표
            const PITCH_CENTER_X = 300;
            const PITCH_CENTER_Y = 150;

            // 초기 선수 위치
            const initialPositionsA = [
                { x: 100, y: 50 },
                { x: 100, y: 150 },
                { x: 100, y: 250 },
            ];

            const initialPositionsB = [
                { x: 500, y: 50 },
                { x: 500, y: 150 },
                { x: 500, y: 250 },
            ];

            // 공과 선수 움직이기
            function moveElement(element, x, y, smooth = false) {
                if (smooth) {
                    element.style.transition = 'all 0.5s ease-in-out';
                } else {
                    element.style.transition = 'none';
                }
                element.style.left = `${x}px`;
                element.style.top = `${y}px`;
            }

            // 거리 계산 함수
            function getDistance(x1, y1, x2, y2) {
                return Math.sqrt((x2 - x1) ** 2 + (y2 - y1) ** 2);
            }

            // 플레이어 초기화 및 재설정
            function resetPlayers() {
                // A팀 선수 초기화
                playersA.forEach((player, index) => {
                    moveElement(
                        player,
                        initialPositionsA[index].x,
                        initialPositionsA[index].y
                    );
                    player.dataset.speed = Math.random() * 90 + 30; // 속도 재설정
                });

                // B팀 선수 초기화
                playersB.forEach((player, index) => {
                    moveElement(
                        player,
                        initialPositionsB[index].x,
                        initialPositionsB[index].y
                    );
                    player.dataset.speed = Math.random() * 90 + 30; // 속도 재설정
                });
            }

            // 공을 향해 움직이는 선수
            function moveTowardsBall(player) {
                const playerX = parseInt(player.style.left);
                const playerY = parseInt(player.style.top);
                const ballX = parseInt(ball.style.left);
                const ballY = parseInt(ball.style.top);

                const distance = getDistance(playerX, playerY, ballX, ballY);
                const speed = parseFloat(player.dataset.speed);

                if (distance > 10) {
                    const dx = ballX - playerX;
                    const dy = ballY - playerY;

                    const moveX = playerX + (dx / distance) * speed;
                    const moveY = playerY + (dy / distance) * speed;

                    moveElement(player, moveX, moveY);
                }
            }

            // 경기 시뮬레이션
            function simulateMatch(events) {
                // 공을 중앙에 배치
                moveElement(ball, PITCH_CENTER_X, PITCH_CENTER_Y);

                // 플레이어 초기화
                resetPlayers();

                let currentTime = 0;
                const interval = setInterval(() => {
                    currentTime++;

                    // 선수들을 공 방향으로 이동
                    playersA.forEach(moveTowardsBall);
                    playersB.forEach(moveTowardsBall);

                    // 골 이벤트 처리
                    events.forEach((event) => {
                        if (event.time === currentTime) {
                            const isTeamA = event.team === 'A';

                            // 골대로 공 이동
                            moveElement(
                                ball,
                                isTeamA ? 40 : 560,
                                PITCH_CENTER_Y,
                                true
                            );

                            setTimeout(() => {
                                // 득점 처리
                                if (isTeamA) scoreA++;
                                else scoreB++;

                                // 점수판 업데이트
                                scoreboard.textContent = `Team A ${scoreA} - ${scoreB} Team B`;

                                // 경기 재시작
                                moveElement(
                                    ball,
                                    PITCH_CENTER_X,
                                    PITCH_CENTER_Y
                                );
                                resetPlayers();
                            }, 1000);
                        }
                    });

                    // 경기 종료
                    if (currentTime > 20) {
                        clearInterval(interval);
                        if (scoreA > scoreB) {
                            alert('A 팀 승리!');
                        } else if (scoreA < scoreB) {
                            alert('B 팀 승리!');
                        } else {
                            alert('무승부');
                        }

                        //console.log('Match ended!');
                    }
                }, 1000);
            }

            // 시뮬레이션 시작
            simulateMatch(matchEvents);
        </script>
    </body>
</html>
